---
layout: framework
sidebar: category-list
---

{%- if site.posts.size > 0 -%}

  <!-- Build category tree data for JavaScript -->
  <script id="category-data" type="application/json">
  {
    "posts": [
      {% for post in site.posts %}
        {
          "title": {{ post.title | jsonify }},
          "url": "{{ post.url | relative_url }}",
          "date": "{{ post.date | date: '%Y-%m-%d' }}",
          "categories": {{ post.categories | jsonify }}
        }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
  }
  </script>

  <!-- Categories Tree Container -->
  <div class="page-card">
    <div class="page-card-header">
      <div class="card-buttons">
        <span class="card-btn btn-close"></span>
        <span class="card-btn btn-minimize"></span>
        <span class="card-btn btn-maximize"></span>
      </div>
      <div class="card-title">Categories</div>
      <div class="card-actions">
        <button class="card-action-btn" onclick="expandAll()" title="Expand All">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 15l-6-6-6 6"/>
          </svg>
        </button>
        <button class="card-action-btn" onclick="collapseAll()" title="Collapse All">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M6 9l6 6 6-6"/>
          </svg>
        </button>
      </div>
    </div>
    <div class="tree-content">
      <div id="category-tree" class="category-tree"></div>
    </div>
  </div>

{%- endif -%}

<style>
  /* ===== Unified Page Card Style ===== */
  .page-card {
    background: #fff;
    border-radius: 8px;
    border: 1px solid #e5e5e5;
    margin: 20px 0 40px;
    overflow: hidden;
  }

  .page-card-header {
    background: linear-gradient(180deg, #fafafa 0%, #f0f0f0 100%);
    padding: 8px 14px;
    display: flex;
    align-items: center;
    border-bottom: 1px solid #e5e5e5;
  }

  .card-buttons {
    display: flex;
    gap: 6px;
  }

  .card-btn {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    display: inline-block;
  }

  .btn-close { background: #ff5f57; }
  .btn-minimize { background: #febc2e; }
  .btn-maximize { background: #28c840; }

  .card-title {
    flex: 1;
    text-align: center;
    font-size: 12px;
    font-weight: 500;
    color: #666;
  }

  .card-actions {
    display: flex;
    gap: 2px;
  }

  .card-action-btn {
    background: transparent;
    border: none;
    color: #888;
    padding: 4px;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.15s;
  }

  .card-action-btn:hover {
    background: #eee;
    color: #555;
  }

  /* ===== Tree Content ===== */
  .tree-content {
    padding: 14px;
    background: #fff;
    max-height: 550px;
    overflow-y: auto;
    font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
  }

  .category-tree {
    font-size: 12px;
    line-height: 1.5;
    color: #333;
  }

  .tree-folder {
    margin-bottom: 2px;
  }

  .tree-folder-header {
    display: flex;
    align-items: center;
    padding: 4px 8px;
    border-radius: 4px;
    cursor: pointer;
    transition: background 0.15s;
  }

  .tree-folder-header:hover {
    background: #f5f5f5;
  }

  .tree-chevron {
    width: 14px;
    height: 14px;
    margin-right: 4px;
    color: #999;
    transition: transform 0.15s;
    flex-shrink: 0;
  }

  .tree-folder.expanded > .tree-folder-header .tree-chevron {
    transform: rotate(90deg);
  }

  .tree-icon {
    width: 16px;
    height: 16px;
    margin-right: 6px;
    flex-shrink: 0;
  }

  .tree-icon.folder { color: #b8860b; }
  .tree-icon.folder-open { color: #daa520; }
  .tree-icon.file { color: #888; }

  .tree-label {
    flex: 1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    color: #333;
  }

  .tree-count {
    font-size: 10px;
    color: #999;
    margin-left: 6px;
    background: #f0f0f0;
    padding: 1px 5px;
    border-radius: 8px;
  }

  .tree-children {
    margin-left: 18px;
    border-left: 1px solid #e5e5e5;
    padding-left: 8px;
    display: none;
  }

  .tree-folder.expanded > .tree-children {
    display: block;
  }

  /* File Items */
  .tree-file {
    display: flex;
    align-items: center;
    padding: 3px 8px;
    border-radius: 4px;
    margin-bottom: 1px;
    transition: all 0.15s;
  }

  .tree-file:hover {
    background: #f5f5f5;
    transform: translateX(2px);
  }

  .tree-file a {
    color: #555;
    text-decoration: none;
    flex: 1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-size: 11px;
  }

  .tree-file a:hover {
    color: #111;
  }

  .tree-file-date {
    font-size: 10px;
    color: #aaa;
    margin-left: 8px;
    flex-shrink: 0;
  }

  /* Show More Button */
  .show-more-container {
    padding: 2px 8px;
  }

  .show-more-btn {
    background: transparent;
    border: 1px dashed #ddd;
    color: #888;
    padding: 3px 10px;
    border-radius: 4px;
    font-size: 10px;
    cursor: pointer;
    transition: all 0.15s;
    width: 100%;
  }

  .show-more-btn:hover {
    border-color: #bbb;
    color: #555;
    background: #fafafa;
  }

  .hidden-files {
    display: none;
  }

  .hidden-files.visible {
    display: block;
  }

  /* Scrollbar */
  .tree-content::-webkit-scrollbar {
    width: 4px;
  }

  .tree-content::-webkit-scrollbar-track {
    background: transparent;
  }

  .tree-content::-webkit-scrollbar-thumb {
    background: #ddd;
    border-radius: 2px;
  }

  /* ===== Dark Theme ===== */
  html[data-theme="dark"] .page-card {
    background: #1e1e1e;
    border-color: #333;
  }

  html[data-theme="dark"] .page-card-header {
    background: linear-gradient(180deg, #2a2a2a 0%, #222 100%);
    border-bottom-color: #333;
  }

  html[data-theme="dark"] .card-title {
    color: #aaa;
  }

  html[data-theme="dark"] .card-action-btn {
    color: #777;
  }

  html[data-theme="dark"] .card-action-btn:hover {
    background: #333;
    color: #ccc;
  }

  html[data-theme="dark"] .tree-content {
    background: #1e1e1e;
  }

  html[data-theme="dark"] .category-tree {
    color: #ccc;
  }

  html[data-theme="dark"] .tree-folder-header:hover {
    background: #2a2a2a;
  }

  html[data-theme="dark"] .tree-chevron {
    color: #666;
  }

  html[data-theme="dark"] .tree-icon.folder { color: #c9a227; }
  html[data-theme="dark"] .tree-icon.folder-open { color: #daa520; }
  html[data-theme="dark"] .tree-icon.file { color: #777; }

  html[data-theme="dark"] .tree-label {
    color: #ccc;
  }

  html[data-theme="dark"] .tree-count {
    color: #777;
    background: #333;
  }

  html[data-theme="dark"] .tree-children {
    border-left-color: #333;
  }

  html[data-theme="dark"] .tree-file:hover {
    background: #2a2a2a;
  }

  html[data-theme="dark"] .tree-file a {
    color: #aaa;
  }

  html[data-theme="dark"] .tree-file a:hover {
    color: #fff;
  }

  html[data-theme="dark"] .tree-file-date {
    color: #666;
  }

  html[data-theme="dark"] .show-more-btn {
    border-color: #444;
    color: #777;
  }

  html[data-theme="dark"] .show-more-btn:hover {
    border-color: #555;
    color: #aaa;
    background: #252525;
  }

  html[data-theme="dark"] .tree-content::-webkit-scrollbar-thumb {
    background: #444;
  }

  /* ===== Mobile ===== */
  @media (max-width: 768px) {
    .page-card {
      margin: 10px 0 30px;
    }

    .tree-content {
      padding: 10px;
      max-height: 450px;
    }

    .category-tree {
      font-size: 11px;
    }

    .tree-children {
      margin-left: 12px;
      padding-left: 6px;
    }

    .tree-file-date {
      display: none;
    }
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const data = JSON.parse(document.getElementById('category-data').textContent);
  const treeContainer = document.getElementById('category-tree');

  function buildTree(posts) {
    const tree = {};
    posts.forEach(post => {
      post.categories.forEach(category => {
        const parts = category.split('/').filter(p => p.trim());
        let current = tree;
        parts.forEach((part, index) => {
          if (!current[part]) {
            current[part] = { __posts: [], __children: {} };
          }
          if (index === parts.length - 1) {
            if (!current[part].__posts.find(p => p.url === post.url)) {
              current[part].__posts.push(post);
            }
          }
          current = current[part].__children;
        });
      });
    });
    return tree;
  }

  const icons = {
    chevron: `<svg class="tree-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>`,
    folder: `<svg class="tree-icon folder" viewBox="0 0 24 24" fill="currentColor"><path d="M10 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/></svg>`,
    folderOpen: `<svg class="tree-icon folder-open" viewBox="0 0 24 24" fill="currentColor"><path d="M20 6h-8l-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z"/></svg>`,
    file: `<svg class="tree-icon file" viewBox="0 0 24 24" fill="currentColor"><path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"/></svg>`
  };

  function renderTree(node, container, depth = 0) {
    const sortedKeys = Object.keys(node).sort((a, b) => {
      const aHas = Object.keys(node[a].__children || {}).length > 0;
      const bHas = Object.keys(node[b].__children || {}).length > 0;
      if (aHas && !bHas) return -1;
      if (!aHas && bHas) return 1;
      return a.localeCompare(b);
    });

    sortedKeys.forEach(key => {
      const item = node[key];
      const hasChildren = Object.keys(item.__children).length > 0;
      const posts = item.__posts || [];
      const totalPosts = countAllPosts(item);

      if (hasChildren || posts.length > 0) {
        const folder = document.createElement('div');
        folder.className = 'tree-folder';
        if (depth === 0) folder.classList.add('expanded');

        const header = document.createElement('div');
        header.className = 'tree-folder-header';
        header.innerHTML = `
          ${icons.chevron}
          <span class="folder-icon">${icons.folder}</span>
          <span class="tree-label">${key}</span>
          <span class="tree-count">${totalPosts}</span>
        `;

        header.addEventListener('click', function() {
          folder.classList.toggle('expanded');
          const folderIcon = header.querySelector('.folder-icon');
          folderIcon.innerHTML = folder.classList.contains('expanded') ? icons.folderOpen : icons.folder;
        });

        folder.appendChild(header);

        const children = document.createElement('div');
        children.className = 'tree-children';

        if (hasChildren) {
          renderTree(item.__children, children, depth + 1);
        }

        if (posts.length > 0) {
          const visibleLimit = 3;
          posts.slice(0, visibleLimit).forEach(post => {
            children.appendChild(createFileElement(post));
          });

          if (posts.length > visibleLimit) {
            const hiddenPosts = posts.slice(visibleLimit);
            const hiddenContainer = document.createElement('div');
            hiddenContainer.className = 'hidden-files';
            hiddenPosts.forEach(post => {
              hiddenContainer.appendChild(createFileElement(post));
            });

            const showMoreContainer = document.createElement('div');
            showMoreContainer.className = 'show-more-container';
            const showMoreBtn = document.createElement('button');
            showMoreBtn.className = 'show-more-btn';
            showMoreBtn.textContent = `+ ${hiddenPosts.length} more`;
            showMoreBtn.addEventListener('click', function(e) {
              e.stopPropagation();
              hiddenContainer.classList.toggle('visible');
              showMoreBtn.textContent = hiddenContainer.classList.contains('visible')
                ? '- collapse' : `+ ${hiddenPosts.length} more`;
            });

            showMoreContainer.appendChild(showMoreBtn);
            children.appendChild(showMoreContainer);
            children.appendChild(hiddenContainer);
          }
        }

        folder.appendChild(children);
        container.appendChild(folder);
      }
    });
  }

  function createFileElement(post) {
    const file = document.createElement('div');
    file.className = 'tree-file';
    file.innerHTML = `
      ${icons.file}
      <a href="${post.url}">${post.title}</a>
      <span class="tree-file-date">${post.date}</span>
    `;
    return file;
  }

  function countAllPosts(node) {
    let count = (node.__posts || []).length;
    Object.values(node.__children || {}).forEach(child => {
      count += countAllPosts(child);
    });
    return count;
  }

  const tree = buildTree(data.posts);
  renderTree(tree, treeContainer);

  document.querySelectorAll('.tree-folder').forEach(folder => {
    if (folder.parentElement === treeContainer) {
      folder.classList.add('expanded');
      const folderIcon = folder.querySelector('.folder-icon');
      if (folderIcon) folderIcon.innerHTML = icons.folderOpen;
    }
  });
});

function expandAll() {
  document.querySelectorAll('.tree-folder').forEach(folder => {
    folder.classList.add('expanded');
    const folderIcon = folder.querySelector('.folder-icon');
    if (folderIcon) {
      folderIcon.innerHTML = `<svg class="tree-icon folder-open" viewBox="0 0 24 24" fill="currentColor"><path d="M20 6h-8l-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z"/></svg>`;
    }
  });
}

function collapseAll() {
  document.querySelectorAll('.tree-folder').forEach(folder => {
    folder.classList.remove('expanded');
    const folderIcon = folder.querySelector('.folder-icon');
    if (folderIcon) {
      folderIcon.innerHTML = `<svg class="tree-icon folder" viewBox="0 0 24 24" fill="currentColor"><path d="M10 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/></svg>`;
    }
  });
}
</script>
