---
layout: framework
sidebar: tag-list
---

{%- if site.posts.size > 0 -%}

  {%- include functions.html func='log' level='debug' msg='Get tags value' -%}
  {%- include functions.html func='get_tags' -%}
  {% assign tags = return %}

  <!-- Tag Graph Visualization -->
  <div class="tag-graph-container">
    <svg id="tag-graph"></svg>
    <div id="tag-tooltip" class="tag-tooltip"></div>
  </div>

  <!-- Post-Tag Data for JavaScript -->
  <script id="post-tags-data" type="application/json">
  [
    {% for post in site.posts %}
      {
        "title": {{ post.title | jsonify }},
        "url": "{{ post.url | relative_url }}",
        "date": "{{ post.date | date: '%Y-%m-%d' }}",
        "tags": {{ post.tags | jsonify }}
      }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]
  </script>

  <!-- Tags Window Container -->
  <div class="tags-window-container">
    <div class="tags-window-header">
      <div class="tags-window-buttons">
        <span class="tw-btn tw-close"></span>
        <span class="tw-btn tw-minimize"></span>
        <span class="tw-btn tw-maximize"></span>
      </div>
      <div class="tags-window-title">All Posts by Tags</div>
      <div class="tags-window-actions">
        <button class="tw-action-btn active" data-view="all" title="All Posts">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/>
            <rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/>
          </svg>
        </button>
        <button class="tw-action-btn" data-view="tags" title="By Tags">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83 0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/>
            <line x1="7" y1="7" x2="7.01" y2="7"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Tag Filter Pills -->
    <div class="tags-filter-bar">
      <button class="tag-pill active" data-tag="all">
        <span class="pill-icon">ðŸ“š</span>
        <span class="pill-label">All</span>
        <span class="pill-count">{{ site.posts.size }}</span>
      </button>
      {% for tag in tags %}
        {% assign tag_posts = site.posts | where: 'tags', tag %}
        <button class="tag-pill" data-tag="{{ tag }}">
          <span class="pill-label">{{ tag }}</span>
          <span class="pill-count">{{ tag_posts.size }}</span>
        </button>
      {% endfor %}
    </div>

    <!-- Posts Grid -->
    <div class="tags-window-content">
      <div class="posts-grid" id="posts-grid">
        {% for post in site.posts %}
        <div class="post-card" data-tags="{{ post.tags | join: ',' }}">
          <a href="{{ post.url | relative_url }}" class="post-card-link">
            <div class="post-card-header">
              <span class="post-card-date">{{ post.date | date: "%m/%d" }}</span>
              <span class="post-card-year">{{ post.date | date: "%Y" }}</span>
            </div>
            <div class="post-card-title">{{ post.title | escape }}</div>
            <div class="post-card-tags">
              {% for tag in post.tags limit:2 %}
              <span class="mini-tag">{{ tag }}</span>
              {% endfor %}
              {% if post.tags.size > 2 %}
              <span class="mini-tag more">+{{ post.tags.size | minus: 2 }}</span>
              {% endif %}
            </div>
          </a>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>

{%- endif -%}

<style>
  /* Tag Graph Container */
  .tag-graph-container {
    margin: 40px 0 30px;
    position: relative;
    background: #fafafa;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    overflow: hidden;
    border: 1px solid #e0e0e0;
  }

  #tag-graph {
    width: 100%;
    height: 400px;
    display: block;
  }

  /* Graph Links */
  .graph-link {
    stroke: #e53935;
    stroke-opacity: 0.3;
    fill: none;
    transition: stroke-opacity 0.3s ease;
  }

  .graph-link.highlighted {
    stroke-opacity: 0.8;
  }

  .graph-link.dimmed {
    stroke-opacity: 0.08;
  }

  /* Graph Nodes */
  .graph-node {
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .graph-node circle {
    fill: #666;
    stroke: #fff;
    stroke-width: 2px;
    transition: all 0.3s ease;
  }

  .graph-node:hover circle {
    fill: #e53935;
    stroke-width: 3px;
    filter: drop-shadow(0 0 8px rgba(229, 57, 53, 0.5));
  }

  .graph-node.dimmed circle {
    fill: #ccc;
    opacity: 0.4;
  }

  .graph-node.highlighted circle {
    fill: #c62828;
    stroke-width: 3px;
    filter: drop-shadow(0 0 10px rgba(229, 57, 53, 0.6));
  }

  /* Node Labels */
  .node-label {
    font-size: 11px;
    font-weight: 600;
    fill: #444;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s ease;
    text-anchor: middle;
  }

  .graph-node:hover .node-label,
  .graph-node.highlighted .node-label {
    opacity: 1;
  }

  /* Tooltip */
  .tag-tooltip {
    position: absolute;
    padding: 10px 14px;
    background: rgba(255, 255, 255, 0.98);
    border-radius: 8px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
    font-size: 13px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.2s ease;
    z-index: 100;
    max-width: 200px;
    border: 1px solid #eee;
  }

  .tag-tooltip.visible {
    opacity: 1;
  }

  .tag-tooltip .tag-name {
    font-weight: 700;
    color: #e53935;
    margin-bottom: 4px;
  }

  .tag-tooltip .tag-count {
    color: #666;
    font-size: 12px;
  }

  /* ===== Tags Window Container ===== */
  .tags-window-container {
    background: #fafafa;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    overflow: hidden;
    margin: 0 0 40px;
    border: 1px solid #e0e0e0;
  }

  /* Window Header - Mac Style */
  .tags-window-header {
    background: linear-gradient(180deg, #555 0%, #444 100%);
    padding: 10px 16px;
    display: flex;
    align-items: center;
    border-bottom: 2px solid #333;
  }

  .tags-window-buttons {
    display: flex;
    gap: 8px;
  }

  .tw-btn {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    display: inline-block;
    border: 0.5px solid rgba(0, 0, 0, 0.15);
  }

  .tw-close { background: #ff5f57; }
  .tw-minimize { background: #febc2e; }
  .tw-maximize { background: #28c840; }

  .tags-window-title {
    flex: 1;
    text-align: center;
    font-size: 13px;
    font-weight: 600;
    color: #fff;
    letter-spacing: 0.5px;
  }

  .tags-window-actions {
    display: flex;
    gap: 4px;
  }

  .tw-action-btn {
    background: transparent;
    border: none;
    color: #888;
    padding: 4px 6px;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .tw-action-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
  }

  .tw-action-btn.active {
    background: rgba(229, 57, 53, 0.3);
    color: #fff;
  }

  /* Tag Filter Bar */
  .tags-filter-bar {
    padding: 16px;
    background: #f5f5f5;
    border-bottom: 1px solid #e0e0e0;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    max-height: 120px;
    overflow-y: auto;
  }

  .tag-pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 20px;
    font-size: 12px;
    color: #555;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .tag-pill:hover {
    border-color: #e53935;
    color: #e53935;
    transform: translateY(-1px);
  }

  .tag-pill.active {
    background: #e53935;
    border-color: #e53935;
    color: white;
  }

  .tag-pill .pill-icon {
    font-size: 14px;
  }

  .tag-pill .pill-count {
    background: rgba(0, 0, 0, 0.08);
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 10px;
    font-weight: 600;
  }

  .tag-pill.active .pill-count {
    background: rgba(255, 255, 255, 0.25);
  }

  /* Posts Grid - 2 Column Layout */
  .tags-window-content {
    padding: 20px;
    background: #fafafa;
    min-height: 300px;
    max-height: 600px;
    overflow-y: auto;
  }

  .posts-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
  }

  /* Post Card */
  .post-card {
    transition: all 0.25s ease;
  }

  .post-card.hidden {
    display: none;
  }

  .post-card-link {
    display: block;
    padding: 12px 16px;
    background: #fff;
    border-radius: 8px;
    border: 1px solid #eee;
    text-decoration: none;
    color: inherit;
    transition: all 0.25s ease;
  }

  .post-card-link:hover {
    background: rgba(229, 57, 53, 0.05);
    border-color: #e53935;
    transform: translateX(6px);
    box-shadow: 0 2px 8px rgba(229, 57, 53, 0.1);
  }

  .post-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 6px;
  }

  .post-card-date {
    font-size: 12px;
    font-weight: 600;
    color: #e53935;
  }

  .post-card-year {
    font-size: 10px;
    color: #aaa;
  }

  .post-card-title {
    font-size: 13px;
    font-weight: 500;
    color: #333;
    line-height: 1.4;
    margin-bottom: 8px;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }

  .post-card-link:hover .post-card-title {
    color: #c62828;
  }

  .post-card-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
  }

  .mini-tag {
    font-size: 10px;
    padding: 2px 6px;
    background: #f0f0f0;
    border-radius: 4px;
    color: #777;
  }

  .mini-tag.more {
    background: #e0e0e0;
    color: #555;
  }

  /* Scrollbar */
  .tags-window-content::-webkit-scrollbar,
  .tags-filter-bar::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  .tags-window-content::-webkit-scrollbar-track,
  .tags-filter-bar::-webkit-scrollbar-track {
    background: transparent;
  }

  .tags-window-content::-webkit-scrollbar-thumb,
  .tags-filter-bar::-webkit-scrollbar-thumb {
    background: #ccc;
    border-radius: 3px;
  }

  .tags-window-content::-webkit-scrollbar-thumb:hover,
  .tags-filter-bar::-webkit-scrollbar-thumb:hover {
    background: #aaa;
  }

  /* ===== Dark Theme ===== */
  html[data-theme="dark"] .tag-graph-container {
    background: #1e1e1e;
    border-color: #333;
  }

  html[data-theme="dark"] .graph-link {
    stroke: #ef5350;
  }

  html[data-theme="dark"] .graph-node circle {
    fill: #888;
    stroke: #1e1e1e;
  }

  html[data-theme="dark"] .graph-node:hover circle {
    fill: #ef5350;
  }

  html[data-theme="dark"] .graph-node.highlighted circle {
    fill: #ff7043;
  }

  html[data-theme="dark"] .graph-node.dimmed circle {
    fill: #444;
  }

  html[data-theme="dark"] .node-label {
    fill: #ddd;
  }

  html[data-theme="dark"] .tag-tooltip {
    background: rgba(30, 30, 30, 0.98);
    border-color: #444;
  }

  html[data-theme="dark"] .tag-tooltip .tag-name {
    color: #ef5350;
  }

  html[data-theme="dark"] .tag-tooltip .tag-count {
    color: #aaa;
  }

  html[data-theme="dark"] .tags-window-container {
    background: #1e1e1e;
    border-color: #333;
  }

  html[data-theme="dark"] .tags-window-header {
    background: linear-gradient(180deg, #333 0%, #222 100%);
    border-bottom-color: #444;
  }

  html[data-theme="dark"] .tags-filter-bar {
    background: #252525;
    border-bottom-color: #333;
  }

  html[data-theme="dark"] .tag-pill {
    background: #333;
    border-color: #444;
    color: #ccc;
  }

  html[data-theme="dark"] .tag-pill:hover {
    border-color: #ef5350;
    color: #ef5350;
  }

  html[data-theme="dark"] .tag-pill.active {
    background: #c62828;
    border-color: #c62828;
  }

  html[data-theme="dark"] .tag-pill .pill-count {
    background: rgba(255, 255, 255, 0.1);
  }

  html[data-theme="dark"] .tags-window-content {
    background: #1e1e1e;
  }

  html[data-theme="dark"] .post-card-link {
    background: #252525;
    border-color: #333;
  }

  html[data-theme="dark"] .post-card-link:hover {
    background: rgba(229, 57, 53, 0.1);
    border-color: #c62828;
  }

  html[data-theme="dark"] .post-card-date {
    color: #ef5350;
  }

  html[data-theme="dark"] .post-card-year {
    color: #666;
  }

  html[data-theme="dark"] .post-card-title {
    color: #ddd;
  }

  html[data-theme="dark"] .post-card-link:hover .post-card-title {
    color: #ff7043;
  }

  html[data-theme="dark"] .mini-tag {
    background: #333;
    color: #999;
  }

  html[data-theme="dark"] .mini-tag.more {
    background: #444;
    color: #aaa;
  }

  html[data-theme="dark"] .tags-window-content::-webkit-scrollbar-thumb,
  html[data-theme="dark"] .tags-filter-bar::-webkit-scrollbar-thumb {
    background: #444;
  }

  /* ===== Mobile Responsive ===== */
  @media (max-width: 768px) {
    .tag-graph-container {
      margin: 20px 0;
    }

    #tag-graph {
      height: 300px;
    }

    .node-label {
      font-size: 9px;
    }

    .tags-window-header {
      padding: 8px 12px;
    }

    .tags-window-title {
      font-size: 12px;
    }

    .tags-filter-bar {
      padding: 12px;
      gap: 6px;
      max-height: 100px;
    }

    .tag-pill {
      padding: 4px 10px;
      font-size: 11px;
    }

    .tags-window-content {
      padding: 12px;
      max-height: 500px;
    }

    .posts-grid {
      grid-template-columns: 1fr;
      gap: 8px;
    }

    .post-card-link {
      padding: 10px 12px;
    }

    .post-card-title {
      font-size: 12px;
      -webkit-line-clamp: 1;
    }
  }
</style>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // ===== Tag Filter Functionality =====
    const tagPills = document.querySelectorAll('.tag-pill');
    const postCards = document.querySelectorAll('.post-card');

    function filterByTag(selectedTag) {
      // Update active pill
      tagPills.forEach(pill => {
        pill.classList.toggle('active', pill.dataset.tag === selectedTag);
      });

      // Filter posts
      postCards.forEach(card => {
        const cardTags = card.dataset.tags.split(',');
        if (selectedTag === 'all' || cardTags.includes(selectedTag)) {
          card.classList.remove('hidden');
        } else {
          card.classList.add('hidden');
        }
      });
    }

    // Add click handlers to pills
    tagPills.forEach(pill => {
      pill.addEventListener('click', () => {
        filterByTag(pill.dataset.tag);
      });
    });

    // ===== Tag Graph =====
    const svg = d3.select('#tag-graph');
    const tooltip = document.getElementById('tag-tooltip');
    const container = document.querySelector('.tag-graph-container');

    if (!svg.node() || !container) return;

    // Get post-tags data
    const postTagsData = JSON.parse(document.getElementById('post-tags-data').textContent);

    // Build nodes (unique tags) and edges (co-occurrences)
    const tagCounts = {};
    const edgeCounts = {};

    postTagsData.forEach(post => {
      const tags = post.tags || [];

      // Count tag occurrences
      tags.forEach(tag => {
        tagCounts[tag] = (tagCounts[tag] || 0) + 1;
      });

      // Count co-occurrences (edges)
      for (let i = 0; i < tags.length; i++) {
        for (let j = i + 1; j < tags.length; j++) {
          const key = [tags[i], tags[j]].sort().join('|||');
          edgeCounts[key] = (edgeCounts[key] || 0) + 1;
        }
      }
    });

    // Create nodes array
    const nodes = Object.entries(tagCounts).map(([tag, count]) => ({
      id: tag,
      count: count,
      radius: Math.max(6, Math.min(20, 4 + count * 3))
    }));

    // Create links array
    const links = Object.entries(edgeCounts).map(([key, count]) => {
      const [source, target] = key.split('|||');
      return {
        source,
        target,
        weight: count
      };
    });

    // Setup SVG dimensions
    const width = container.offsetWidth;
    const height = parseInt(getComputedStyle(svg.node()).height);

    svg.attr('viewBox', [0, 0, width, height]);

    // Create force simulation
    const simulation = d3.forceSimulation(nodes)
      .force('link', d3.forceLink(links)
        .id(d => d.id)
        .distance(d => 80 - d.weight * 10)
        .strength(d => 0.3 + d.weight * 0.1))
      .force('charge', d3.forceManyBody()
        .strength(-120))
      .force('center', d3.forceCenter(width / 2, height / 2))
      .force('collision', d3.forceCollide()
        .radius(d => d.radius + 8)
        .strength(0.9))
      .force('x', d3.forceX(width / 2).strength(0.05))
      .force('y', d3.forceY(height / 2).strength(0.05));

    // Create links
    const link = svg.append('g')
      .attr('class', 'links')
      .selectAll('line')
      .data(links)
      .join('line')
      .attr('class', 'graph-link')
      .attr('stroke-width', d => Math.max(1, d.weight * 2));

    // Create nodes group
    const node = svg.append('g')
      .attr('class', 'nodes')
      .selectAll('g')
      .data(nodes)
      .join('g')
      .attr('class', 'graph-node')
      .call(d3.drag()
        .on('start', dragstarted)
        .on('drag', dragged)
        .on('end', dragended));

    // Add circles to nodes
    node.append('circle')
      .attr('r', d => d.radius);

    // Add labels (hidden by default, shown on hover)
    node.append('text')
      .attr('class', 'node-label')
      .attr('dy', d => -d.radius - 6)
      .text(d => d.id);

    // Node interactions
    node.on('mouseenter', function(event, d) {
      // Show tooltip
      tooltip.innerHTML = `
        <div class="tag-name">${d.id}</div>
        <div class="tag-count">${d.count} post${d.count > 1 ? 's' : ''}</div>
      `;
      tooltip.classList.add('visible');

      // Position tooltip
      const rect = container.getBoundingClientRect();
      const x = event.clientX - rect.left + 15;
      const y = event.clientY - rect.top - 10;
      tooltip.style.left = `${Math.min(x, width - 150)}px`;
      tooltip.style.top = `${y}px`;

      // Highlight connected nodes and links
      const connectedNodes = new Set();
      connectedNodes.add(d.id);

      link.each(function(l) {
        if (l.source.id === d.id || l.target.id === d.id) {
          connectedNodes.add(l.source.id);
          connectedNodes.add(l.target.id);
          d3.select(this).classed('highlighted', true).classed('dimmed', false);
        } else {
          d3.select(this).classed('dimmed', true).classed('highlighted', false);
        }
      });

      node.each(function(n) {
        if (connectedNodes.has(n.id)) {
          d3.select(this).classed('highlighted', true).classed('dimmed', false);
        } else {
          d3.select(this).classed('dimmed', true).classed('highlighted', false);
        }
      });
    })
    .on('mouseleave', function() {
      tooltip.classList.remove('visible');
      link.classed('highlighted', false).classed('dimmed', false);
      node.classed('highlighted', false).classed('dimmed', false);
    })
    .on('click', function(event, d) {
      event.preventDefault();
      // Filter by clicked tag
      filterByTag(d.id);
      // Scroll to post list
      const windowContainer = document.querySelector('.tags-window-container');
      if (windowContainer) {
        windowContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    });

    // Update positions on tick
    simulation.on('tick', () => {
      nodes.forEach(d => {
        d.x = Math.max(d.radius + 10, Math.min(width - d.radius - 10, d.x));
        d.y = Math.max(d.radius + 10, Math.min(height - d.radius - 10, d.y));
      });

      link
        .attr('x1', d => d.source.x)
        .attr('y1', d => d.source.y)
        .attr('x2', d => d.target.x)
        .attr('y2', d => d.target.y);

      node.attr('transform', d => `translate(${d.x},${d.y})`);
    });

    // Drag functions
    function dragstarted(event, d) {
      if (!event.active) simulation.alphaTarget(0.3).restart();
      d.fx = d.x;
      d.fy = d.y;
    }

    function dragged(event, d) {
      d.fx = event.x;
      d.fy = event.y;
    }

    function dragended(event, d) {
      if (!event.active) simulation.alphaTarget(0);
      d.fx = null;
      d.fy = null;
    }

    // Handle resize
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        const newWidth = container.offsetWidth;
        const newHeight = parseInt(getComputedStyle(svg.node()).height);
        svg.attr('viewBox', [0, 0, newWidth, newHeight]);
        simulation.force('center', d3.forceCenter(newWidth / 2, newHeight / 2));
        simulation.force('x', d3.forceX(newWidth / 2).strength(0.05));
        simulation.force('y', d3.forceY(newHeight / 2).strength(0.05));
        simulation.alpha(0.3).restart();
      }, 300);
    });
  });
</script>
