<div class="visitor-stats-widget">
  <div class="widget-header">
    <h3>방문자 통계</h3>
  </div>
  <div class="widget-content">
    <div class="stat-item">
      <span class="stat-label">오늘</span>
      <span class="stat-value" id="today-visitors">-</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">전체</span>
      <span class="stat-value" id="total-visitors">-</span>
    </div>
  </div>
</div>

<style>
.visitor-stats-widget {
  background: #f5f5f5;
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 20px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
  border: 1px solid #e0e0e0;
}

.visitor-stats-widget .widget-header {
  margin-bottom: 12px;
}

.visitor-stats-widget .widget-header h3 {
  font-size: 0.95rem;
  font-weight: 600;
  color: #333;
  margin: 0;
}

.visitor-stats-widget .widget-content {
  display: flex;
  gap: 12px;
}

.visitor-stats-widget .stat-item {
  flex: 1;
  background: #fff;
  padding: 10px;
  border-radius: 6px;
  text-align: center;
  border: 1px solid #e0e0e0;
}

.visitor-stats-widget .stat-label {
  display: block;
  font-size: 0.75rem;
  color: #666;
  margin-bottom: 4px;
}

.visitor-stats-widget .stat-value {
  display: block;
  font-size: 1.2rem;
  font-weight: 700;
  color: #1e88e5;
}

/* Dark Theme */
html[data-theme="dark"] .visitor-stats-widget {
  background: #2a2a2a;
  border-color: #444;
}

html[data-theme="dark"] .visitor-stats-widget .widget-header h3 {
  color: #e0e0e0;
}

html[data-theme="dark"] .visitor-stats-widget .stat-item {
  background: #1e1e1e;
  border-color: #444;
}

html[data-theme="dark"] .visitor-stats-widget .stat-label {
  color: #aaa;
}

html[data-theme="dark"] .visitor-stats-widget .stat-value {
  color: #64b5f6;
}
</style>

<script>
(function() {
  const STORAGE_KEY = 'blog_visitor_stats';
  const TODAY_KEY = 'blog_last_visit_date';

  function getTodayString() {
    const now = new Date();
    return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
  }

  function getStats() {
    const stored = localStorage.getItem(STORAGE_KEY);
    if (stored) {
      return JSON.parse(stored);
    }
    return { total: 0, today: 0, date: getTodayString() };
  }

  function saveStats(stats) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(stats));
  }

  function updateVisitorStats() {
    const today = getTodayString();
    const lastVisit = localStorage.getItem(TODAY_KEY);
    const stats = getStats();

    // 새로운 방문자인 경우
    if (lastVisit !== today) {
      // 날짜가 바뀐 경우 오늘 카운트 리셋
      if (stats.date !== today) {
        stats.today = 0;
        stats.date = today;
      }

      stats.today++;
      stats.total++;

      localStorage.setItem(TODAY_KEY, today);
      saveStats(stats);
    }

    // 화면에 표시
    document.getElementById('today-visitors').textContent = stats.today;
    document.getElementById('total-visitors').textContent = stats.total;
  }

  // DOM이 로드되면 실행
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', updateVisitorStats);
  } else {
    updateVisitorStats();
  }
})();
</script>
